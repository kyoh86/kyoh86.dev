<!DOCTYPE html>
<html lang="ja-jp">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
 <title>Posts </title>



<meta name="description" content="Works of kyoh86">


<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<meta name="theme-color" content="#4d4d4d">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Raleway%3A400%2C700&amp;subset=latin%2Clatin-ext&amp;ver=4.7.2" type="text/css" media="all">
<link rel="stylesheet" href="https://kyoh86.work/css/font-awesome.min.css" type='text/css' media='all'>

<link href="https://kyoh86.work/css/style.css" rel="stylesheet" type='text/css' media='all'>

<link href="https://kyoh86.work/css/custom.css" rel="stylesheet" type='text/css' media='all'>
<link rel="shortcut icon" href="https://kyoh86.work/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="https://kyoh86.work/img/favicon.ico" type="image/x-icon">

<link href="https://kyoh86.work/posts/index.xml" rel="alternate" type="application/rss+xml" title="kyoh86.work" />
<link href="https://kyoh86.work/posts/index.xml" rel="feed" type="application/rss+xml" title="kyoh86.work" />


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-70974996-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>

  <body class="home blog standard">
    <div class="overflow-container">
      <a class="skip-content" href="#main">Skip to content</a>
      <header id="site-header" class="site-header" role="banner">
        <div class='top-navigation'>
          <div class="container">

  <div id="menu-secondary" class="menu-container menu-secondary" role="navigation">
    <button id="toggle-secondary-navigation" class="toggle-secondary-navigation" aria-label="menu"><i class="fa fa-plus"></i></button>
    <div class="menu">
      <ul id="menu-secondary-items" class="menu-secondary-items">
        
        <li id="menu-item" class="menu-item">
          <a href="/categories/tech">tech</a>
        </li>
        
      </ul>
    </div>
  </div>

    <ul class="social-media-icons">
    
      <li>
        <a class="facebook" target="_blank"
           href="https://www.facebook.com/kyoh.86" >
          <i class="fa fa-facebook" title="facebook"></i>
          <span class="screen-reader-text">facebook</span>
        </a>
      </li>
    

    
      <li>
        <a class="googleplus" target="_blank"
           href="https://plus.google.com/u/0/100199074642864423892" >
          <i class="fa fa-google-plus" title="googleplus"></i>
          <span class="screen-reader-text">googleplus</span>
        </a>
      </li>
    


    
      <li>
      <a href="https://twitter.com/kyoh86"  class="twitter" target="_blank">
          <i class="fa fa-twitter-square" title="twitter"></i>
          <span class="screen-reader-text">twitter</span>
      </a>
      </li>
    

    
      <li>
      <a href="https://www.instagram.com/kyoh86"  class="twitter" target="_blank">
          <i class="fa fa-instagram" title="instagram"></i>
          <span class="screen-reader-text">instagram</span>
      </a>
      </li>
    

    

    
      <li>
      <a href="https://www.linkedin.com/in/kyoh86/" class="linkedin" target="_blank">
          <i class="fa fa-linkedin" title="linkedin"></i>
          <span class="screen-reader-text">linkedin</span>
      </a>
      </li>
    

    
      <li>
      <a href="https://stackoverflow.com/users/3610769/kyoh86"  class="stackoverflow" target="_blank">
          <i class="fa fa-stack-overflow" title="stackoverflow"></i>
          <span class="screen-reader-text">stackoverflow</span>
      </a>
      </li>
    


    
      <li>
      <a href="https://github.com/kyoh86"  class="github" target="_blank">
          <i class="fa fa-github" title="github"></i>
          <span class="screen-reader-text">github</span>
      </a>
      </li>
    
  </ul>


</div>

        </div>

        <div class="container">
          <div id="title-info" class="title-info">
  <div class="site-title">
    
    <a href="/"> kyoh86.work </a>
    </div>
  </div>
  <button id="toggle-navigation" class="toggle-navigation" aria-label="menu">
    <i class="fa fa-bars"></i>
  </button>

  <div id="menu-primary-tracks" class="menu-primary-tracks"></div>
  <div id="menu-primary" class="menu-container menu-primary" role="navigation">
    
    <p class="site-description">Works of kyoh86</p>
    

    <div class="menu">
      <ul id="menu-primary-items" class="menu-primary-items">
        
        
        <li id="menu-item" class="menu-item">
          <a href="https://kyoh86.work/">Home</a>
        </li>
        
        <li id="menu-item" class="menu-item">
          <a href="https://kyoh86.work/about">About</a>
        </li>
        
        <li id="menu-item" class="menu-item">
          <a href="https://kyoh86.work/products/">Products</a>
        </li>
        
      </ul>
    </div>

  </div>

        </div>
      </header>

      <div id="main" class="main" role="main">
        <div class="archive-header">
          <h1>Posts</h1>
        </div>
        <div class="loop-container">
  
    <div class="post zoom full-without-featured excerpt odd">
      
      <div class="excerpt-container">
        <div class="excerpt-meta">
          <span class="date">September 14</span>
          
            <span> / </span>
            <span class="category">
              <a href="/categories/tech">tech</a>
            </span>
          
        </div>
        <div class='excerpt-header'>
          <h2 class='excerpt-title'>
            <a href="https://kyoh86.work/posts/2016-09-14_15-42-22/ ">ECS上のgo製プログラムのプロファイル覗き見る</a>
          </h2>
        </div>
        <div class='excerpt-content'>
          <article>
             SSHトンネリングに必要な情報を得るための手順が多くて忘れるのでメモ。 うっかりsudo忘れる。
前提 goのpprofについては
 http://blog.livedoor.jp/sonots/archives/39879160.html  とか
 http://qiita.com/ikawaha/items/e3b35f09fb49e9217924  とか参照。 当然profiler動いてなきゃ話にならんので注意。
トンネリング  ECSのタスク選ぶ instanceのIP見る sshで入ってsudo su - docker psで、対象サービスのコンテナ探してIDを確認
$ docker ps -f name=api-server --format=&quot;{{.ID}}&quot; 123a456b78  docker inspectで、対象コンテナIDからコンテナのIPアドレス取得
$ docker inspect --format=&quot;{{ .NetworkSettings.IPAddress }}&quot; 123a456b78 172.17.0.1  ssh抜ける
 localhostの適当なポートに、指定インスタンス経由でコンテナのプロファイラのポートをトンネリングさせる
# ssh &lt;instanceIP&gt; -L &lt;port&gt;:&lt;container IP&gt;:&lt;prof port&gt; $ ssh 56.64.122.32 -L 9999:172.17.0.1:33680   プロファイラ見る go tool pprof localhost:9999/debug/pprof/profile  
            <div class="more-link-wrapper"><a class="more-link" href="https://kyoh86.work/posts/2016-09-14_15-42-22/">Read the post<span class="screen-reader-text">This is a Standard Post</span></a></div>
          </article>
        </div>
      </div>
    </div>
  
    <div class="post zoom full-without-featured excerpt even">
      
      <div class="excerpt-container">
        <div class="excerpt-meta">
          <span class="date">June 03</span>
          
            <span> / </span>
            <span class="category">
              <a href="/categories/tech">tech</a>
            </span>
          
        </div>
        <div class='excerpt-header'>
          <h2 class='excerpt-title'>
            <a href="https://kyoh86.work/posts/2016-06-03_11-11-54/ ">JSON to CSV (for Excel)</a>
          </h2>
        </div>
        <div class='excerpt-content'>
          <article>
            CSV（Character-Separated Values）ってなんだかとってもアレですよね！ 某Excelの場合、Tab区切りのUTF-16LE with BOMじゃないと素直には開けなかったりするし。
JSON to CSV(TSV) ツールは色々あるけど、jq か csvkit がよさげ。
 jq -r '(.[]|[.name,.age])|@tsv' in2csv -fjson|csvformat -TU1'  ただのCSVにするなら、in2csv -fjson だけでいい   utf-8 to utf-16LEBOM nkf または iconv
 nkf -W8 -w16L iconv -f UTF-8 -t UTF-16  繋げば・・・ csvkit×nkfの例：
cat hoge.json|in2csv -fjson|csvformat -TU1|nkf -W8 -w16L&gt;hoge.csv'
ってな感じ。
某M$ utf-8のCSV(Comma-Separated Values)をもっと素直に開けるように対応してくれないかなあ。
            <div class="more-link-wrapper"><a class="more-link" href="https://kyoh86.work/posts/2016-06-03_11-11-54/">Read the post<span class="screen-reader-text">This is a Standard Post</span></a></div>
          </article>
        </div>
      </div>
    </div>
  
    <div class="post zoom full-without-featured excerpt odd">
      
      <div class="excerpt-container">
        <div class="excerpt-meta">
          <span class="date">May 09</span>
          
            <span> / </span>
            <span class="category">
              <a href="/categories/tech">tech</a>
            </span>
          
        </div>
        <div class='excerpt-header'>
          <h2 class='excerpt-title'>
            <a href="https://kyoh86.work/posts/2016-05-09_22-33-33/ ">Perl6でも愛が生まれた</a>
          </h2>
        </div>
        <div class='excerpt-content'>
          <article>
             say &quot;生&quot;~&amp;&quot;死&quot;  参考  愛が生まれた - Qiita なんで愛が生まれるのか - Qiita  
            <div class="more-link-wrapper"><a class="more-link" href="https://kyoh86.work/posts/2016-05-09_22-33-33/">Read the post<span class="screen-reader-text">This is a Standard Post</span></a></div>
          </article>
        </div>
      </div>
    </div>
  
    <div class="post zoom full-without-featured excerpt even">
      
      <div class="excerpt-container">
        <div class="excerpt-meta">
          <span class="date">May 06</span>
          
            <span> / </span>
            <span class="category">
              <a href="/categories/tech">tech</a>
            </span>
          
        </div>
        <div class='excerpt-header'>
          <h2 class='excerpt-title'>
            <a href="https://kyoh86.work/posts/2016-05-06_23-13-18/ ">PHP&#43;postfix with Gmail on El Capitan</a>
          </h2>
        </div>
        <div class='excerpt-content'>
          <article>
            OSX上でphp -S localhost:8080なんぞして、mb_send_mailなアプリを作ってたんですが、メール送信テストしたくてもまーなかなか上手く行かないもので。やっとの思いで一通したのでここに眠らせる。R.I.P.
ベースとなった環境  OSX El Capitan 10.11.4 postfix (mail_version = 2.11.0) PHP 5.6.21 (cli) (built: Apr 29 2016 02:31:44)  これだけhomebrewによる。   用意する各種設定ファイル  postfix 設定ファイル  # : # : 前略 # : # CUSTOM ######## # Minimum Postfix-specific configurations. mail_owner = _postfix setgid_group = _postdrop myhostname = smtp.gmail.com relayhost=[smtp.gmail.com]:587 smtp_sasl_auth_enable = yes smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd smtp_sasl_tls_security_options = noanonymous smtp_use_tls = yes smtp_sasl_mechanism_filter = plain   postfix パスワードファイル (/etc/postfix/sasl_passwd)
            <div class="more-link-wrapper"><a class="more-link" href="https://kyoh86.work/posts/2016-05-06_23-13-18/">Read the post<span class="screen-reader-text">This is a Standard Post</span></a></div>
          </article>
        </div>
      </div>
    </div>
  
    <div class="post zoom full-without-featured excerpt odd">
      
      <div class="excerpt-container">
        <div class="excerpt-meta">
          <span class="date">April 13</span>
          
            <span> / </span>
            <span class="category">
              <a href="/categories/tech">tech</a>
            </span>
          
        </div>
        <div class='excerpt-header'>
          <h2 class='excerpt-title'>
            <a href="https://kyoh86.work/posts/2016-04-13_13-10-56/ ">【メモ】mongoDBで環境間のデータに差異が無いか確認する方法</a>
          </h2>
        </div>
        <div class='excerpt-content'>
          <article>
            動機 開発環境とリリース前確認用の環境で、MongoDBのデータに差異が無いか確認しようと思ったけど、 数十万件あるデータを比べるとか無理じゃね？と思った時に。
mongoexport使う mongoexportで出力して、ちょいちょいと整形してやればよろし。 クエリも投げられるので、対象データの絞り込みは容易。
一致するはず！と期待しているフィールドを選んで、--fields と --sort にそれぞれ指定してあげる。
mongoexport --host example.mongo --db hoge --collection piyo --query '{userId:ObjectId(&quot;xxxxx&quot;)}' --fields name,credit,zip --sort '{name:1,credit:1,zip:1}' --out hoge.json mongoexport --host example.mongo --db fuga --collection piyo --query '{userId:ObjectId(&quot;xxxxx&quot;)}' --fields name,credit,zip --sort '{name:1,credit:1,zip:1}' --out fuga.json  そんままでは_idが当然のように一致しないので、除去する。_idが無いなら気にしなくていい。
 cat hoge.json | perl -pe 's/&quot;_id&quot; : \{ &quot;\$oid&quot; : &quot;[a-f0-9]+&quot; \}, //g' &gt; hoge-trim.json cat fuga.json | perl -pe 's/&quot;_id&quot; : \{ &quot;\$oid&quot; : &quot;[a-f0-9]+&quot; \}, //g' &gt; fuga-trim.
            <div class="more-link-wrapper"><a class="more-link" href="https://kyoh86.work/posts/2016-04-13_13-10-56/">Read the post<span class="screen-reader-text">This is a Standard Post</span></a></div>
          </article>
        </div>
      </div>
    </div>
  
</div>

      </div>

      <footer id="site-footer" class="site-footer" role="contentinfo">
  <h1>
    
      <a href=""> kyoh86.work </a>
    
  </h1>

  
    <p class="site-description">Works of kyoh86</p>
  

  <div class="menu-footer" role="navigation">
    <div class="menu">
      <ul class="menu-footer-items">
        
      </ul>
    </div>
  </div>

    <ul class="social-media-icons">
    
      <li>
        <a class="facebook" target="_blank"
           href="https://www.facebook.com/kyoh.86" >
          <i class="fa fa-facebook" title="facebook"></i>
          <span class="screen-reader-text">facebook</span>
        </a>
      </li>
    

    
      <li>
        <a class="googleplus" target="_blank"
           href="https://plus.google.com/u/0/100199074642864423892" >
          <i class="fa fa-google-plus" title="googleplus"></i>
          <span class="screen-reader-text">googleplus</span>
        </a>
      </li>
    


    
      <li>
      <a href="https://twitter.com/kyoh86"  class="twitter" target="_blank">
          <i class="fa fa-twitter-square" title="twitter"></i>
          <span class="screen-reader-text">twitter</span>
      </a>
      </li>
    

    
      <li>
      <a href="https://www.instagram.com/kyoh86"  class="twitter" target="_blank">
          <i class="fa fa-instagram" title="instagram"></i>
          <span class="screen-reader-text">instagram</span>
      </a>
      </li>
    

    

    
      <li>
      <a href="https://www.linkedin.com/in/kyoh86/" class="linkedin" target="_blank">
          <i class="fa fa-linkedin" title="linkedin"></i>
          <span class="screen-reader-text">linkedin</span>
      </a>
      </li>
    

    
      <li>
      <a href="https://stackoverflow.com/users/3610769/kyoh86"  class="stackoverflow" target="_blank">
          <i class="fa fa-stack-overflow" title="stackoverflow"></i>
          <span class="screen-reader-text">stackoverflow</span>
      </a>
      </li>
    


    
      <li>
      <a href="https://github.com/kyoh86"  class="github" target="_blank">
          <i class="fa fa-github" title="github"></i>
          <span class="screen-reader-text">github</span>
      </a>
      </li>
    
  </ul>


  <div class="design-credit">
    
      <p>&copy; 2018 kyoh86</p>
    
  </div>
</footer>

    </div>
    <script src="https://kyoh86.work/js/jquery.min.js"></script>
<script src="https://kyoh86.work/js/jquerymigrate.js"></script>
<script src="https://kyoh86.work/js/production.min.js"></script>

  </body>
